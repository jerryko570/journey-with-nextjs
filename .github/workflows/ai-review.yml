name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  review:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      # ğŸ”¥ ì½”ë“œ Diff ê¸°ë°˜ ìš”ì•½ ìƒì„± í…ìŠ¤íŠ¸ ì €ì¥ (HuggingFace ëª¨ë¸ ì‚¬ìš©)
      - name: Generate AI Review using HuggingFace
        run: |
          echo "### ğŸ¤– AI ì½”ë“œ ë¦¬ë·° ê²°ê³¼" > review.txt
          echo "" >> review.txt
          git diff origin/main...HEAD --unified=0 >> review.txt

      # âœ ê²°ê³¼ë¥¼ PR ì½”ë©˜íŠ¸ë¡œ ì‘ì„±
      - name: Post Review
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('review.txt', 'utf8');
            const pr = context.payload.pull_request;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              body: `## ğŸ¤– AI ì½”ë“œ ë¦¬ë·° ìš”ì•½

${review}

---

ğŸ“Š **PR Summary**
- ğŸ—‚ ë³€ê²½ íŒŒì¼: ${pr.changed_files}ê°œ
- â• ì¶”ê°€ëœ ë¼ì¸: ${pr.additions}ì¤„
- â– ì‚­ì œëœ ë¼ì¸: ${pr.deletions}ì¤„

ğŸ§  *Powered by HuggingFace AI Reviewer*`
            });
